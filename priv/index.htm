<!-- See LICENSE for licensing information. -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>ICE computings visualiser</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/static/bullet.js"></script>
    <script type="text/javascript">
    $(document).ready(function(){
        name = 'Icy';
        var bullet;

        var open = function(){
            bullet = $.bullet('ws://localhost:8888/bullet');

            bullet.onopen = function(){
                $('#status').text('online').css({backgroundColor: 'green'});
            };
            bullet.ondisconnect = function(){
                $('#status').text('offline').css({backgroundColor: 'red'});
            };
            bullet.onclose = function(){
                $('#status').text('closed').css({backgroundColor: 'yellow'});
            };

            bullet.onheartbeat = function(){
                console.log('ping: ' + name);
                bullet.send('ping: ' + name);
            };

            // onmessage
            bullet.onmessage = function(e){
                if (e.data != 'pong'){
                    pre = $('#msg')
                    pre.text(pre.text() + e.data + '\n');
                }
            };
        }

        open();

        $('.enable').on('click', function(){
            if (bullet == null){
                open();
            } else {
                bullet.close();
                bullet = null;
            }
        });
    });
    </script>
</head>

<body>
    <p>
        <button id="status" class="enable" style="background-color:cyan;">unknown</button>
        <span id="time">Time: unknown</span>
    </p>

    <hr/>

    <table width="100%" height="100%">
        <tbody>
            <tr>
                <td align="center" valign="middle">
<pre id="msg">
Events recap:
</pre>
                </td>
            </tr>
        </tbody>
    </table>
</body>
</html>

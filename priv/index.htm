<!-- See LICENSE for licensing information. -->
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>ICE computings visualiser</title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
    <script src="/static/bullet.js"></script>
    <script type="text/javascript">
    // <![CDATA[
    $(document).ready(function(){
        name = 'Icy';
        var bullet;

        var open = function(){
            bullet = $.bullet('ws://localhost:8888/bullet');

            bullet.onopen = function(){
                $('#status').text('online');
            };
            bullet.ondisconnect = function(){
                $('#status').text('offline');
            };
            bullet.onclose = function(){
                $('#status').text('closed');
            };

            bullet.onmessage = function(e){
                if (e.data != 'pong'){
                    $('#time').text(e.data);
                }
            };
            bullet.onheartbeat = function(){
                console.log('ping: ' + name);
                bullet.send('ping: ' + name);
            };
        }
        open();
        $('#enable').on('change', function(){
            if (this.checked){
                open();
            } else{
                bullet.close();
                bullet = null;
            }
        });
        $('#send').on('click', function(){
            if (bullet) {   
                bullet.send('time: ' + name + ' ' + $('#time').text());
            }
        });
    });
    // ]]>
    </script>
</head>

<body>
    <p>
        <input type="checkbox" checked="yes" id="enable"></input>
        <span id="time">Time: unknown</span>
        <span id="status">unknown</span>
        <button id="send">Send Time</button>
    </p>
</body>
</html>
